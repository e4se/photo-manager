$(function(){function e(i,a){var n=a.type.split("/");n[0],currentUploads.data("multiple")||currentUploads.parents(".uploadFiles").find(".attachImg").empty(),currentUploads.parents(".uploadFiles").find(".attachImg").append('<progress max="100" value="0" id="progress'+i+'" class="progressUploadPhoto"></progress>');var r=new XMLHttpRequest;r.upload.onprogress=function(a){$("#progress"+i).prop("max",a.total),$("#progress"+i).prop("value",a.loaded)},r.onload=function(){try{var a=JSON.parse(r.response)}catch(a){return alert("Что-то пошло не так, возможно файл превышает лимит загрузки. (50мб)"),$("#progress"+i).remove(),!0}if(a.error)return alert(a.error),$("#progress"+i).remove(),!0;currentUploads.data("multiple")||currentUploads.parents(".uploadFiles").find(".attachImg").empty();var t='<img src="'+a.url+'" >',e="";if("video"==n[0]){t='<video src="'+a.url+'"  controls="true"></video>';e='<div class="setting__button video__settings" data-id="'+a.id+'"><i class="fa fa-cog"></i></div>'}var o="attach";currentUploads.data("array-name")&&(o=currentUploads.data("array-name"));var d="";if("image"!=n[0]&&"video"!=n[0]){t='<div style="font-size:50px;"><i class="fa fa-file"></i></div>';d="<p>"+a.real_name+"</p>"}currentUploads.parents(".uploadFiles").find(".attachImg").prepend('<div class="oneAttach" >'+t+'<input hidden="true" name="'+o+'[]" value="'+a.id+'">'+e+'<div class="ui_thumb_x_button" data-id="'+a.id+'" aria-label="Не прикреплять" role="link"><div class="ui_thumb_x"></div></div>'+d+"</div>"),$("#progress"+i).remove()},r.onerror=function(){alert("Не верный формат файла.")};var t=new FormData;t.append("upload",a),r.open("POST",currentUploads.data("url"),!0),r.setRequestHeader("X-CSRF-TOKEN",$('meta[name="csrf-token"]').attr("content")),r.send(t)}$("html").on("dragover",function(a){$("#modal_form_upload").length&&(a.preventDefault(),$(this).find(".dragFile").addClass("active"))}),$("body").on("mouseout",function(a){$("#modal_form_upload").length&&(a.preventDefault(),$(this).find(".dragFile").removeClass("active"))}),$("html").on("drop",function(a){a.preventDefault(),$(".dragFile").removeClass("active")}),$("html").on("dragover",".dragFile",function(a){$(this).addClass("superActive"),$(this).find("span").text("Отпустите клавишу мыши")}),$("body").on("dragleave",".dragFile",function(a){$(this).removeClass("superActive"),$(this).find("span").text("Перенесите сюда файл")}),$("html").on("drop",".dragFile",function(a){a.preventDefault();var t=a.originalEvent.dataTransfer.files;$("#modal_form_upload").length&&($("body").css("overflow","auto"),$("#modal_form_upload").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),$(".addNewContent").animate({opacity:0,bottom:"-35px"},200),$(this).removeClass("active")),$.each(t,function(a,t){e(a,t)})}),$("body").on("change",".attachUpload",function(){$("#modal_form_upload").length&&($("body").css("overflow","auto"),$("#modal_form_upload").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),$(".addNewContent").animate({opacity:0,bottom:"-35px"},200));var a=$(this)[0].files;$.each(a,function(a,t){e(a,t)})}),$("body").on("click",".ui_thumb_x_button",function(a){$this=$(this).parents("form").attr("id"),$('[form="'+$this+'"]').prop("disabled",!1),$('[form="'+$this+'"]').html("Сохранить");var t=$(this);setTimeout(function(){t.parent().css("display","none"),t.parent(".oneAttach").length&&1!=t.parents(".uploadFiles").data("delete")?t.parent().remove():$.ajax({type:"POST",url:t.data("delete-url"),headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:function(a){t.parent().remove()},error:function(){t.parent().css("display","-webkit-inline-box")}})},100)}),$("body").on("click",".uploadFileButton",function(a){a.preventDefault(),currentUploads=$(this),$(".oneUploadBefore").remove();var t=$("#modal_form_upload").find(".modal-preloader");if(t.find(".spinner").css("display","block"),t.css("display","block"),$("#modal_form_upload").remove(),!$("#modal_form_upload").length){var e="";currentUploads.data("multiple")&&(e='multiple="true"');var o="image/jpeg,image/png,image/gif,video/*";currentUploads.data("accept")&&(o=currentUploads.data("accept")),$("body").append('<div id="modal_form_upload"><div class="dragFile"><div class="drag_text"><span>Перенесите сюда файл</span></div></div><span id="modal_close_upload"><br></span><div class="title ">Прикрепить файл</div><input name="attach" type="file" class="attachUpload" accept="'+o+'" '+e+' hidden="true"><div class="button-upload"><i>+</i>Загрузить файл</div><div class="beforeUploads"><div class="modal-preloader" "><span class="spinner" ></span></div></div><a class="btn btn-success addNewContent" href="">Добавить</a></div> <div id="overlay"></div>')}$(".dragFile").removeClass("active").removeClass("superActive"),$(".dragFile").find("span").text("Перенесите сюда файл"),$("body").css("overflow","hidden"),$("#overlay").fadeIn(400,function(){$("#modal_form_upload").css("display","block").animate({opacity:1,top:"50%"},200),$.ajax({type:"GET",url:currentUploads.data("url-get"),success:function(a){addNewContent={};var t=a;$(".oneUploadBefore").remove(),$.each(t,function(a,t){var e;e='<div class="ui_thumb_x_button" data-id="'+t.id+'" data-delete-url="'+t.deleteUrl+'" aria-label="Не прикреплять" role="link"><div class="ui_thumb_x"></div></div>';var o='<img src="'+t.url+'" >';if("video"==t.type)o='<video src="'+t.url+'" autoplay="true" muted="true"></video>';var d="";if("file"==t.type){o='<div style="font-size:50px;"><i class="fa fa-file"></i></div>';d="<p>"+t.real_name+"</p>"}$(".beforeUploads").prepend('<div class="oneUploadBefore" data-real-name="'+t.real_name+'" data-type="'+t.type+'" data-id="'+t.id+'" data-url="'+t.url+'">'+o+'<div class="blackopacity"></div><div class="media_check_btn"  data-type="'+t.type+'" data-id="'+t.id+'" data-real-name="'+t.real_name+'" data-url="'+t.url+'"></div>'+e+d+"</div>")});var e=$("#modal_form_upload").find(".modal-preloader");e.find(".spinner").fadeOut(),e.delay(350).fadeOut("slow")},error:function(){}})})}),$("body").on("click",".oneUploadBefore",function(a){if(a.preventDefault(),0==Object.keys(addNewContent).length&&!$(this).find(".ui_thumb_x_button:hover").length&&!$(this).find(".media_check_btn:hover").length){currentUploads.data("multiple")||currentUploads.parents(".uploadFiles").find(".attachImg").empty();var t='<img src="'+$(this).data("url")+'" >',e="";if("video"==$(this).data("type")){t='<video src="'+$(this).data("url")+'"  controls="true"></video>';e='<div class="setting__button video__settings" data-id="'+$(this).data("id")+'"><i class="fa fa-cog"></i></div>'}var o="attach";currentUploads.data("array-name")&&(o=currentUploads.data("array-name"));var d="";if("image"!=$(this).data("type")&&"video"!=$(this).data("type")){t='<div style="font-size:50px;"><i class="fa fa-file"></i></div>';d="<p>"+$(this).data("real-name")+"</p>"}currentUploads.parents(".uploadFiles").find(".attachImg").prepend('<div class="oneAttach">'+t+'<input hidden="true" name="'+o+'[]" value="'+$(this).data("id")+'">'+e+'<div class="ui_thumb_x_button" data-id="'+$(this).data("id")+'" aria-label="Не прикреплять" role="link"><div class="ui_thumb_x"></div></div>'+d+"</div>"),$("body").css("overflow","auto"),$("#modal_form_upload").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),$(".addNewContent").animate({opacity:0,bottom:"-35px"},200)}}),$("body").on("click","#modal_close_upload, #overlay",function(a){a.preventDefault(),$("body").css("overflow","auto"),$("#modal_form_upload").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),$(".addNewContent").animate({opacity:0,bottom:"-35px"},200)}),$("body").on("click",".media_check_btn",function(a){$(this).toggleClass("selected"),addNewContent[$(this).data("id")]?(delete addNewContent[$(this).data("id")],$(this).parent().find(".blackopacity").css("opacity","0")):($(this).parent().find(".blackopacity").css("opacity","0.33"),addNewContent[$(this).data("id")]=[$(this).data("url"),$(this).data("type"),$(this).data("real-name")]),1==Object.keys(addNewContent).length?$(".addNewContent").animate({opacity:1,bottom:"10px"},200,function(){}):0==Object.keys(addNewContent).length&&$(".addNewContent").animate({opacity:0,bottom:"-35px"},200,function(){})}),$("body").on("click",".addNewContent",function(a){a.preventDefault(),$.each(addNewContent,function(a,t){currentUploads.data("multiple")||currentUploads.parents(".uploadFiles").find(".attachImg").empty();var e='<img src="'+t[0]+'" >',o="";if("video"==t[1]){e='<video src="'+t[0]+'"  controls="true"></video>';o='<div class="setting__button video__settings" data-id="'+a+'"><i class="fa fa-cog"></i></div>'}var d="attach";currentUploads.data("array-name")&&(d=currentUploads.data("array-name"));var i="";if("image"!=t[1]&&"video"!=t[1]){e='<div style="font-size:50px;"><i class="fa fa-file"></i></div>';i="<p>"+t[2]+"</p>"}currentUploads.parents(".uploadFiles").find(".attachImg").prepend('<div class="oneAttach">'+e+'<input hidden="true" name="'+d+'[]" value="'+a+'">'+o+'<div class="ui_thumb_x_button" data-id="'+a+'" aria-label="Не прикреплять" role="link"><div class="ui_thumb_x"></div></div>'+i+"</div>"),$("body").css("overflow","auto"),$("#modal_form_upload").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)}),$(".addNewContent").animate({opacity:0,bottom:"-35px"},200)})}),$("body").on("click",".button-upload",function(a){$(".attachUpload").trigger("click")}),$("body").on("click",".addScan",function(a){currentUploads=$(this),$(".attachUpload").trigger("click")})});